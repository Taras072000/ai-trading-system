# План очистки проекта AI торговой системы

## 1. Обзор проекта

### Текущее состояние
- **Общее количество файлов**: 150+ компонентов
- **Размер проекта**: ~500MB
- **Критические модули**: 25 файлов
- **Тестовые файлы**: 35+ файлов
- **Отладочные файлы**: 15+ файлов

### Цели очистки
- Уменьшение размера проекта на 30-40%
- Ускорение времени сборки на 25%
- Упрощение структуры проекта
- Удаление устаревших компонентов

## 2. Категории файлов для удаления

### 2.1 Тестовые файлы (Приоритет: ВЫСОКИЙ)

#### Файлы для немедленного удаления:
- `test_fix.py` - временный тест исправления бага с test_days
- `test_fix_simple.py` - дублирует функциональность test_fix.py
- `test_bug_fix.py` - тест исправления багов
- `test_lava_debug.py` - отладочный тест для lava_ai
- `test_lava_fixed.py` - тест исправлений lava_ai
- `test_lava_improvements.py` - тест улучшений lava_ai
- `test_lava_winrate.py` - тест winrate для lava_ai
- `test_mistral_local.py` - локальный тест mistral
- `test_orchestrator_debug.py` - отладка оркестратора

**Критерии удаления:**
- Созданы для отладки конкретных проблем
- Не используются в автоматизированном тестировании
- Дублируют функциональность основных тестов

### 2.2 Отладочные файлы (Приоритет: ВЫСОКИЙ)

#### Файлы для удаления:
- `debug_ai_models.py` - отладка AI моделей
- `debug_consensus.py` - отладка консенсуса
- `debug_consensus_logic.py` - отладка логики консенсуса
- `debug_get_ai_signals.py` - отладка получения AI сигналов
- `debug_signals.py` - отладка сигналов
- `debug_signals_issue.py` - отладка проблем с сигналами
- `simple_signal_debug.py` - простая отладка сигналов

**Критерии удаления:**
- Используются только для разовой отладки
- Не интегрированы в основную систему
- Содержат временный код

### 2.3 Mock и демо файлы (Приоритет: СРЕДНИЙ)

#### Файлы для удаления:
- `mock_ai_trading_system.py` - имитация AI торговой системы (654 строки)
- `demo_system.py` - демонстрационная система
- `simple_calibrator.py` - простой калибратор

**Критерии удаления:**
- Используются только для демонстрации
- Дублируют функциональность основных модулей
- Не используются в продакшене

### 2.4 Устаревшие конфигурационные файлы (Приоритет: ВЫСОКИЙ)

#### Файлы с датами для удаления:
- `calibrated_config_20251024_150456.json`
- `optimization_lava_ai_20251024_*.json`
- `optimization_lgbm_ai_20251024_*.json`
- `optimization_mistral_ai_20251024_*.json`
- `optimized_config_20251024_152434.json`

**Критерии удаления:**
- Файлы старше 1 месяца
- Содержат устаревшие конфигурации
- Заменены новыми версиями

### 2.5 Диагностические отчеты (Приоритет: СРЕДНИЙ)

#### Файлы для удаления:
- `ai_models_diagnostics_20251024_151422.txt`
- `diagnostic_report_20251024_151048.txt`
- `trading_logic_analysis_20251024_*.txt`
- `zero_trades_analysis_20251024_151234.txt`

**Критерии удаления:**
- Временные отчеты с датами
- Информация устарела
- Не используются для анализа

## 3. Детализированный план выполнения

### Этап 1: Аудит и анализ зависимостей (1-2 дня)

#### 3.1.1 Анализ импортов
```bash
# Поиск всех импортов для каждого файла
grep -r "import.*test_" . --include="*.py"
grep -r "import.*debug_" . --include="*.py"
grep -r "import.*mock_" . --include="*.py"
```

#### 3.1.2 Проверка использования файлов
```bash
# Поиск ссылок на файлы в коде
find . -name "*.py" -exec grep -l "test_fix" {} \;
find . -name "*.py" -exec grep -l "debug_" {} \;
find . -name "*.py" -exec grep -l "mock_ai" {} \;
```

#### 3.1.3 Анализ конфигурационных файлов
- Проверить ссылки на устаревшие конфигурации
- Убедиться в наличии актуальных версий
- Создать резервные копии критических конфигураций

### Этап 2: Подготовка к удалению (1 день)

#### 3.2.1 Создание резервной копии
```bash
# Создание полной резервной копии проекта
tar -czf backup_before_cleanup_$(date +%Y%m%d).tar.gz .
```

#### 3.2.2 Создание списка файлов для удаления
```bash
# Создание файла со списком для удаления
cat > files_to_delete.txt << EOF
test_fix.py
test_fix_simple.py
test_bug_fix.py
debug_ai_models.py
mock_ai_trading_system.py
calibrated_config_20251024_150456.json
# ... полный список
EOF
```

#### 3.2.3 Проверка критических зависимостей
- Убедиться, что основные модули не импортируют удаляемые файлы
- Проверить конфигурационные файлы на ссылки
- Проанализировать скрипты запуска

### Этап 3: Поэтапное удаление (2-3 дня)

#### 3.3.1 Удаление тестовых файлов (День 1)
```bash
# Удаление тестовых файлов
rm -f test_fix.py test_fix_simple.py test_bug_fix.py
rm -f test_lava_*.py test_mistral_local.py
rm -f test_orchestrator_debug.py

# Проверка системы после удаления
python main.py --test-mode
```

#### 3.3.2 Удаление отладочных файлов (День 1)
```bash
# Удаление отладочных файлов
rm -f debug_*.py simple_signal_debug.py

# Проверка основных функций
python winrate_test_with_results2.py --quick-test
```

#### 3.3.3 Удаление mock и demo файлов (День 2)
```bash
# Удаление mock файлов
rm -f mock_ai_trading_system.py demo_system.py
rm -f simple_calibrator.py

# Проверка AI модулей
python -c "from ai_modules.ai_manager import AIManager; print('AI Manager OK')"
```

#### 3.3.4 Удаление устаревших конфигураций (День 2)
```bash
# Удаление конфигураций с датами
rm -f *_20251024_*.json *_20251024_*.txt

# Проверка конфигурации
python config.py --validate
```

### Этап 4: Тестирование и валидация (1-2 дня)

#### 3.4.1 Полное тестирование системы
```bash
# Запуск основных тестов
python test_system.py
python winrate_test_with_results2.py --test-days 1
python run_sequential_testing.py --quick-mode
```

#### 3.4.2 Проверка производительности
```bash
# Измерение времени запуска
time python main.py --init-only

# Проверка использования памяти
python -c "import psutil; import main; print(f'Memory: {psutil.Process().memory_info().rss / 1024 / 1024:.1f} MB')"
```

#### 3.4.3 Валидация архитектуры
- Проверить все импорты
- Убедиться в работоспособности AI модулей
- Протестировать торговую логику

### Этап 5: Обновление документации (1 день)

#### 3.5.1 Обновление README файлов
- Удалить ссылки на удаленные файлы
- Обновить инструкции по установке
- Актуализировать примеры использования

#### 3.5.2 Обновление конфигурационных файлов
- Очистить .gitignore от устаревших паттернов
- Обновить requirements.txt
- Проверить setup.py или pyproject.toml

## 4. Критерии завершения

### 4.1 Технические критерии
- ✅ Отсутствие ошибок импорта
- ✅ Успешное прохождение всех основных тестов
- ✅ Уменьшение размера проекта на 30-40%
- ✅ Ускорение времени запуска на 25%
- ✅ Отсутствие битых ссылок в документации

### 4.2 Функциональные критерии
- ✅ Работоспособность всех AI модулей
- ✅ Корректная работа торговой логики
- ✅ Успешное выполнение тестирования стратегий
- ✅ Функционирование системы мониторинга

### 4.3 Качественные критерии
- ✅ Чистота кодовой базы
- ✅ Актуальность документации
- ✅ Соответствие архитектурным принципам

## 5. Процедуры безопасности

### 5.1 Резервное копирование
```bash
# Создание резервной копии перед каждым этапом
backup_project() {
    local stage=$1
    tar -czf "backup_stage_${stage}_$(date +%Y%m%d_%H%M%S).tar.gz" .
    echo "Backup created: backup_stage_${stage}_$(date +%Y%m%d_%H%M%S).tar.gz"
}
```

### 5.2 Откат изменений
```bash
# Процедура отката в случае проблем
rollback() {
    local backup_file=$1
    echo "Rolling back to: $backup_file"
    tar -xzf "$backup_file"
    echo "Rollback completed"
}
```

### 5.3 Проверочные точки
- После каждого этапа удаления
- Перед обновлением документации
- После завершения всех изменений

## 6. Ожидаемые результаты

### 6.1 Количественные улучшения
- **Размер проекта**: уменьшение с ~500MB до ~300MB
- **Количество файлов**: сокращение с 150+ до 100-110
- **Время запуска**: ускорение на 25-30%
- **Использование памяти**: снижение на 15-20%

### 6.2 Качественные улучшения
- Упрощенная структура проекта
- Более понятная архитектура
- Легкость сопровождения
- Улучшенная производительность

## 7. Риски и митигация

### 7.1 Высокие риски
- **Удаление критических зависимостей**
  - Митигация: Тщательный анализ импортов
- **Потеря важных конфигураций**
  - Митигация: Резервное копирование
- **Нарушение работы системы**
  - Митигация: Поэтапное тестирование

### 7.2 Средние риски
- **Потеря исторических данных**
  - Митигация: Архивирование отчетов
- **Проблемы с документацией**
  - Митигация: Систематическое обновление

## 8. Временная шкала

| Этап | Длительность | Ответственный | Критерии завершения |
|------|-------------|---------------|-------------------|
| Аудит и анализ | 1-2 дня | DevOps | Полный список зависимостей |
| Подготовка | 1 день | DevOps | Резервные копии созданы |
| Удаление файлов | 2-3 дня | Developer | Файлы удалены, тесты пройдены |
| Тестирование | 1-2 дня | QA | Все тесты успешны |
| Документация | 1 день | Technical Writer | Документация обновлена |

**Общая длительность**: 6-9 рабочих дней

## 9. Контрольные точки

### 9.1 Ежедневные проверки
- Статус выполнения плана
- Результаты тестирования
- Выявленные проблемы

### 9.2 Еженедельные отчеты
- Прогресс по этапам
- Метрики производительности
- Обновления документации

## 10. Заключение

Данный план обеспечивает систематический подход к очистке проекта с минимизацией рисков и максимизацией пользы. Следование плану позволит создать более чистую, быструю и поддерживаемую кодовую базу.