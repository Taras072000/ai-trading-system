# План полного бэкапа торговой системы Peper Binance v4

## 1. Обзор стратегии бэкапа

### 1.1 Цель бэкапа
Создание полной резервной копии торговой системы Peper Binance v4 перед началом реализации плана улучшений для обеспечения возможности быстрого восстановления в случае критических ошибок.

### 1.2 Принципы бэкапа
- **Полнота**: Резервное копирование всех компонентов системы
- **Целостность**: Проверка корректности всех резервных копий
- **Версионность**: Создание меток времени для каждого бэкапа
- **Безопасность**: Защита конфиденциальных данных
- **Восстановимость**: Гарантия возможности полного восстановления

## 2. Компоненты для резервного копирования

### 2.1 Критические компоненты системы

**Приоритет 1 - Критически важные:**
- Обученные модели машинного обучения (папка `models/`)
- Конфигурационные файлы (папка `config/`)
- Основные модули AI (папка `ai_modules/`)
- Главные исполняемые файлы (`main.py`, `config.py`, `config_params.py`)

**Приоритет 2 - Важные:**
- Утилиты и вспомогательные модули (папка `utils/`)
- Система управления базой данных (папка `database/`)
- Аналитические модули (папка `analytics/`)
- Документация и руководства (`.md` файлы)

**Приоритет 3 - Дополнительные:**
- Логи и отчеты (`cleanup_log.txt`, `cleanup_report.json`)
- Тестовые и вспомогательные скрипты
- Файлы зависимостей (`requirements.txt`)

### 2.2 Детальный список файлов и директорий

```
/Users/mac/Documents/Peper Binance v4 Clean/
├── ai_modules/ (КРИТИЧНО)
│   ├── ai_manager.py
│   ├── lava_ai.py
│   ├── lgbm_ai.py
│   ├── mistral_ai.py
│   ├── mistral_server_manager.py
│   ├── multi_ai_orchestrator.py
│   ├── reinforcement_learning_engine.py
│   └── trading_ai.py
├── models/ (КРИТИЧНО)
│   ├── *_config.json (все конфигурации моделей)
│   ├── *_features.json (все наборы признаков)
│   ├── *_scaler.joblib (все скейлеры)
│   ├── *_trading_model.joblib (все обученные модели)
│   └── mistral-7b-instruct-v0.1.Q4_K_M.gguf
├── config/ (КРИТИЧНО)
│   ├── config_manager.py
│   ├── reinforcement_learning_config.json
│   └── reinforcement_learning_profiles.json
├── database/ (ВАЖНО)
│   ├── persistence_manager.py
│   └── reinforcement_learning_db.py
├── analytics/ (ВАЖНО)
│   └── reinforcement_learning_analytics.py
├── utils/ (ВАЖНО)
│   └── timezone_utils.py
├── .trae/documents/ (ВАЖНО)
│   └── [все .md файлы документации]
├── main.py (КРИТИЧНО)
├── config.py (КРИТИЧНО)
├── config_params.py (КРИТИЧНО)
├── requirements.txt (ВАЖНО)
└── [остальные .py файлы] (ДОПОЛНИТЕЛЬНО)
```

## 3. Процедуры создания бэкапа

### 3.1 Подготовительные действия

**Шаг 1: Остановка системы**
```bash
# Остановить все активные процессы торговой системы
pkill -f "python.*main.py"
pkill -f "python.*multi_ai"
```

**Шаг 2: Проверка целостности данных**
```bash
# Проверить размеры критических файлов
ls -la models/*.joblib
ls -la config/*.json
```

**Шаг 3: Создание директории бэкапа**
```bash
BACKUP_DATE=$(date +"%Y%m%d_%H%M%S")
BACKUP_DIR="/Users/mac/Documents/Backups/Peper_Binance_v4_${BACKUP_DATE}"
mkdir -p "$BACKUP_DIR"
```

### 3.2 Создание резервных копий

**Полное копирование системы:**
```bash
#!/bin/bash
# backup_system.sh

BACKUP_DATE=$(date +"%Y%m%d_%H%M%S")
SOURCE_DIR="/Users/mac/Documents/Peper Binance v4 Clean"
BACKUP_DIR="/Users/mac/Documents/Backups/Peper_Binance_v4_${BACKUP_DATE}"

echo "Создание бэкапа торговой системы..."
echo "Дата: $BACKUP_DATE"
echo "Источник: $SOURCE_DIR"
echo "Назначение: $BACKUP_DIR"

# Создание директории бэкапа
mkdir -p "$BACKUP_DIR"

# Копирование критических компонентов
echo "Копирование критических компонентов..."
cp -r "$SOURCE_DIR/ai_modules" "$BACKUP_DIR/"
cp -r "$SOURCE_DIR/models" "$BACKUP_DIR/"
cp -r "$SOURCE_DIR/config" "$BACKUP_DIR/"
cp "$SOURCE_DIR/main.py" "$BACKUP_DIR/"
cp "$SOURCE_DIR/config.py" "$BACKUP_DIR/"
cp "$SOURCE_DIR/config_params.py" "$BACKUP_DIR/"

# Копирование важных компонентов
echo "Копирование важных компонентов..."
cp -r "$SOURCE_DIR/database" "$BACKUP_DIR/"
cp -r "$SOURCE_DIR/analytics" "$BACKUP_DIR/"
cp -r "$SOURCE_DIR/utils" "$BACKUP_DIR/"
cp -r "$SOURCE_DIR/.trae" "$BACKUP_DIR/"
cp "$SOURCE_DIR/requirements.txt" "$BACKUP_DIR/"

# Копирование дополнительных файлов
echo "Копирование дополнительных файлов..."
cp "$SOURCE_DIR"/*.py "$BACKUP_DIR/" 2>/dev/null || true
cp "$SOURCE_DIR"/*.md "$BACKUP_DIR/" 2>/dev/null || true
cp "$SOURCE_DIR"/*.txt "$BACKUP_DIR/" 2>/dev/null || true
cp "$SOURCE_DIR"/*.json "$BACKUP_DIR/" 2>/dev/null || true

# Создание манифеста бэкапа
echo "Создание манифеста бэкапа..."
cat > "$BACKUP_DIR/backup_manifest.txt" << EOF
Бэкап торговой системы Peper Binance v4
Дата создания: $BACKUP_DATE
Источник: $SOURCE_DIR
Версия системы: v4

Критические компоненты:
- ai_modules/ ($(ls -1 "$BACKUP_DIR/ai_modules" | wc -l) файлов)
- models/ ($(ls -1 "$BACKUP_DIR/models" | wc -l) файлов)
- config/ ($(ls -1 "$BACKUP_DIR/config" | wc -l) файлов)
- main.py, config.py, config_params.py

Размер бэкапа: $(du -sh "$BACKUP_DIR" | cut -f1)
EOF

echo "Бэкап завершен: $BACKUP_DIR"
```

### 3.3 Создание архива

```bash
# Создание сжатого архива
cd "/Users/mac/Documents/Backups"
tar -czf "Peper_Binance_v4_${BACKUP_DATE}.tar.gz" "Peper_Binance_v4_${BACKUP_DATE}/"

# Создание контрольной суммы
shasum -a 256 "Peper_Binance_v4_${BACKUP_DATE}.tar.gz" > "Peper_Binance_v4_${BACKUP_DATE}.sha256"
```

## 4. Специальные процедуры для моделей ML

### 4.1 Снапшоты моделей машинного обучения

**Создание детального снапшота каждой модели:**
```bash
#!/bin/bash
# backup_models.sh

MODELS_DIR="/Users/mac/Documents/Peper Binance v4 Clean/models"
BACKUP_MODELS_DIR="$BACKUP_DIR/models_detailed"
mkdir -p "$BACKUP_MODELS_DIR"

# Для каждой торговой пары
for pair in ADAUSDT BNBUSDT BTCUSDT DOTUSDT SOLUSDT; do
    echo "Создание снапшота модели $pair..."
    
    # Создание директории для пары
    mkdir -p "$BACKUP_MODELS_DIR/$pair"
    
    # Копирование файлов модели
    cp "$MODELS_DIR/${pair}_config.json" "$BACKUP_MODELS_DIR/$pair/"
    cp "$MODELS_DIR/${pair}_features.json" "$BACKUP_MODELS_DIR/$pair/"
    cp "$MODELS_DIR/${pair}_scaler.joblib" "$BACKUP_MODELS_DIR/$pair/"
    cp "$MODELS_DIR/${pair}_trading_model.joblib" "$BACKUP_MODELS_DIR/$pair/"
    
    # Создание метаданных модели
    cat > "$BACKUP_MODELS_DIR/$pair/model_metadata.txt" << EOF
Модель: $pair
Дата бэкапа: $(date)
Размер модели: $(ls -lh "$MODELS_DIR/${pair}_trading_model.joblib" | awk '{print $5}')
Размер скейлера: $(ls -lh "$MODELS_DIR/${pair}_scaler.joblib" | awk '{print $5}')
Конфигурация: $(wc -l < "$MODELS_DIR/${pair}_config.json") строк
Признаки: $(wc -l < "$MODELS_DIR/${pair}_features.json") строк
EOF
done

# Копирование модели Mistral
cp "$MODELS_DIR/mistral-7b-instruct-v0.1.Q4_K_M.gguf" "$BACKUP_MODELS_DIR/"
```

### 4.2 Валидация моделей

```bash
#!/bin/bash
# validate_models.sh

echo "Валидация резервных копий моделей..."

for pair in ADAUSDT BNBUSDT BTCUSDT DOTUSDT SOLUSDT; do
    echo "Проверка модели $pair..."
    
    # Проверка существования файлов
    if [[ ! -f "$BACKUP_MODELS_DIR/$pair/${pair}_trading_model.joblib" ]]; then
        echo "ОШИБКА: Отсутствует модель для $pair"
        exit 1
    fi
    
    # Проверка размера файлов
    MODEL_SIZE=$(stat -f%z "$BACKUP_MODELS_DIR/$pair/${pair}_trading_model.joblib")
    if [[ $MODEL_SIZE -lt 1000 ]]; then
        echo "ОШИБКА: Подозрительно малый размер модели $pair: $MODEL_SIZE байт"
        exit 1
    fi
    
    echo "✓ Модель $pair прошла валидацию"
done
```

## 5. План восстановления системы

### 5.1 Процедура полного восстановления

**Шаг 1: Подготовка к восстановлению**
```bash
# Остановка текущей системы
pkill -f "python.*main.py"

# Создание резервной копии текущего состояния (если нужно)
mv "/Users/mac/Documents/Peper Binance v4 Clean" "/Users/mac/Documents/Peper Binance v4 Clean_CURRENT_$(date +%Y%m%d_%H%M%S)"
```

**Шаг 2: Восстановление из архива**
```bash
#!/bin/bash
# restore_system.sh

BACKUP_ARCHIVE="$1"  # Путь к архиву бэкапа
RESTORE_DIR="/Users/mac/Documents/Peper Binance v4 Clean"

if [[ -z "$BACKUP_ARCHIVE" ]]; then
    echo "Использование: $0 <путь_к_архиву_бэкапа>"
    exit 1
fi

echo "Восстановление системы из: $BACKUP_ARCHIVE"

# Проверка контрольной суммы
ARCHIVE_DIR=$(dirname "$BACKUP_ARCHIVE")
ARCHIVE_NAME=$(basename "$BACKUP_ARCHIVE" .tar.gz)
if [[ -f "$ARCHIVE_DIR/${ARCHIVE_NAME}.sha256" ]]; then
    echo "Проверка контрольной суммы..."
    cd "$ARCHIVE_DIR"
    if ! shasum -a 256 -c "${ARCHIVE_NAME}.sha256"; then
        echo "ОШИБКА: Контрольная сумма не совпадает!"
        exit 1
    fi
    echo "✓ Контрольная сумма корректна"
fi

# Извлечение архива
echo "Извлечение архива..."
cd "/Users/mac/Documents"
tar -xzf "$BACKUP_ARCHIVE"

# Переименование в рабочую директорию
EXTRACTED_DIR=$(basename "$BACKUP_ARCHIVE" .tar.gz)
mv "$EXTRACTED_DIR" "Peper Binance v4 Clean"

echo "✓ Система восстановлена в: $RESTORE_DIR"
```

**Шаг 3: Проверка восстановленной системы**
```bash
#!/bin/bash
# verify_restore.sh

RESTORE_DIR="/Users/mac/Documents/Peper Binance v4 Clean"

echo "Проверка восстановленной системы..."

# Проверка критических файлов
CRITICAL_FILES=(
    "main.py"
    "config.py"
    "config_params.py"
    "ai_modules/ai_manager.py"
    "ai_modules/trading_ai.py"
    "models/BTCUSDT_trading_model.joblib"
    "config/config_manager.py"
)

for file in "${CRITICAL_FILES[@]}"; do
    if [[ ! -f "$RESTORE_DIR/$file" ]]; then
        echo "ОШИБКА: Отсутствует критический файл: $file"
        exit 1
    fi
    echo "✓ $file"
done

# Проверка Python зависимостей
cd "$RESTORE_DIR"
if [[ -f "requirements.txt" ]]; then
    echo "Проверка зависимостей Python..."
    python3 -m pip check
fi

echo "✓ Восстановление прошло успешно"
```

### 5.2 Частичное восстановление компонентов

**Восстановление только моделей:**
```bash
#!/bin/bash
# restore_models_only.sh

BACKUP_DIR="$1"
CURRENT_DIR="/Users/mac/Documents/Peper Binance v4 Clean"

# Создание резервной копии текущих моделей
cp -r "$CURRENT_DIR/models" "$CURRENT_DIR/models_backup_$(date +%Y%m%d_%H%M%S)"

# Восстановление моделей из бэкапа
cp -r "$BACKUP_DIR/models"/* "$CURRENT_DIR/models/"

echo "✓ Модели восстановлены из бэкапа"
```

**Восстановление только конфигурации:**
```bash
#!/bin/bash
# restore_config_only.sh

BACKUP_DIR="$1"
CURRENT_DIR="/Users/mac/Documents/Peper Binance v4 Clean"

# Создание резервной копии текущей конфигурации
cp -r "$CURRENT_DIR/config" "$CURRENT_DIR/config_backup_$(date +%Y%m%d_%H%M%S)"
cp "$CURRENT_DIR/config.py" "$CURRENT_DIR/config_backup_$(date +%Y%m%d_%H%M%S).py"

# Восстановление конфигурации из бэкапа
cp -r "$BACKUP_DIR/config"/* "$CURRENT_DIR/config/"
cp "$BACKUP_DIR/config.py" "$CURRENT_DIR/"
cp "$BACKUP_DIR/config_params.py" "$CURRENT_DIR/"

echo "✓ Конфигурация восстановлена из бэкапа"
```

## 6. Автоматизированные скрипты

### 6.1 Главный скрипт бэкапа

```bash
#!/bin/bash
# full_backup.sh - Главный скрипт для создания полного бэкапа

set -e  # Остановка при ошибке

# Конфигурация
SOURCE_DIR="/Users/mac/Documents/Peper Binance v4 Clean"
BACKUP_BASE_DIR="/Users/mac/Documents/Backups"
BACKUP_DATE=$(date +"%Y%m%d_%H%M%S")
BACKUP_DIR="$BACKUP_BASE_DIR/Peper_Binance_v4_$BACKUP_DATE"
LOG_FILE="$BACKUP_BASE_DIR/backup_log_$BACKUP_DATE.txt"

# Функция логирования
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# Проверка существования исходной директории
if [[ ! -d "$SOURCE_DIR" ]]; then
    log "ОШИБКА: Исходная директория не найдена: $SOURCE_DIR"
    exit 1
fi

# Создание директории для бэкапов
mkdir -p "$BACKUP_BASE_DIR"

log "Начало создания бэкапа торговой системы Peper Binance v4"
log "Источник: $SOURCE_DIR"
log "Назначение: $BACKUP_DIR"

# Остановка системы
log "Остановка торговой системы..."
pkill -f "python.*main.py" 2>/dev/null || true
pkill -f "python.*multi_ai" 2>/dev/null || true
sleep 2

# Создание директории бэкапа
mkdir -p "$BACKUP_DIR"

# Копирование критических компонентов
log "Копирование критических компонентов..."
cp -r "$SOURCE_DIR/ai_modules" "$BACKUP_DIR/" && log "✓ ai_modules скопированы"
cp -r "$SOURCE_DIR/models" "$BACKUP_DIR/" && log "✓ models скопированы"
cp -r "$SOURCE_DIR/config" "$BACKUP_DIR/" && log "✓ config скопированы"
cp "$SOURCE_DIR/main.py" "$BACKUP_DIR/" && log "✓ main.py скопирован"
cp "$SOURCE_DIR/config.py" "$BACKUP_DIR/" && log "✓ config.py скопирован"
cp "$SOURCE_DIR/config_params.py" "$BACKUP_DIR/" && log "✓ config_params.py скопирован"

# Копирование важных компонентов
log "Копирование важных компонентов..."
cp -r "$SOURCE_DIR/database" "$BACKUP_DIR/" 2>/dev/null && log "✓ database скопирована" || log "⚠ database не найдена"
cp -r "$SOURCE_DIR/analytics" "$BACKUP_DIR/" 2>/dev/null && log "✓ analytics скопирована" || log "⚠ analytics не найдена"
cp -r "$SOURCE_DIR/utils" "$BACKUP_DIR/" 2>/dev/null && log "✓ utils скопированы" || log "⚠ utils не найдены"
cp -r "$SOURCE_DIR/.trae" "$BACKUP_DIR/" 2>/dev/null && log "✓ .trae скопирована" || log "⚠ .trae не найдена"
cp "$SOURCE_DIR/requirements.txt" "$BACKUP_DIR/" 2>/dev/null && log "✓ requirements.txt скопирован" || log "⚠ requirements.txt не найден"

# Копирование дополнительных файлов
log "Копирование дополнительных файлов..."
cp "$SOURCE_DIR"/*.py "$BACKUP_DIR/" 2>/dev/null || true
cp "$SOURCE_DIR"/*.md "$BACKUP_DIR/" 2>/dev/null || true
cp "$SOURCE_DIR"/*.txt "$BACKUP_DIR/" 2>/dev/null || true
cp "$SOURCE_DIR"/*.json "$BACKUP_DIR/" 2>/dev/null || true

# Создание манифеста
log "Создание манифеста бэкапа..."
cat > "$BACKUP_DIR/backup_manifest.txt" << EOF
Бэкап торговой системы Peper Binance v4
Дата создания: $BACKUP_DATE
Источник: $SOURCE_DIR
Версия системы: v4

Критические компоненты:
- ai_modules/ ($(ls -1 "$BACKUP_DIR/ai_modules" 2>/dev/null | wc -l) файлов)
- models/ ($(ls -1 "$BACKUP_DIR/models" 2>/dev/null | wc -l) файлов)
- config/ ($(ls -1 "$BACKUP_DIR/config" 2>/dev/null | wc -l) файлов)
- main.py, config.py, config_params.py

Размер бэкапа: $(du -sh "$BACKUP_DIR" | cut -f1)
Лог бэкапа: $LOG_FILE
EOF

# Создание архива
log "Создание сжатого архива..."
cd "$BACKUP_BASE_DIR"
tar -czf "Peper_Binance_v4_$BACKUP_DATE.tar.gz" "Peper_Binance_v4_$BACKUP_DATE/"
log "✓ Архив создан: Peper_Binance_v4_$BACKUP_DATE.tar.gz"

# Создание контрольной суммы
log "Создание контрольной суммы..."
shasum -a 256 "Peper_Binance_v4_$BACKUP_DATE.tar.gz" > "Peper_Binance_v4_$BACKUP_DATE.sha256"
log "✓ Контрольная сумма создана"

# Валидация бэкапа
log "Валидация бэкапа..."
ARCHIVE_SIZE=$(ls -lh "Peper_Binance_v4_$BACKUP_DATE.tar.gz" | awk '{print $5}')
log "Размер архива: $ARCHIVE_SIZE"

# Проверка критических файлов в бэкапе
CRITICAL_FILES=(
    "main.py"
    "config.py"
    "ai_modules/trading_ai.py"
    "models/BTCUSDT_trading_model.joblib"
)

for file in "${CRITICAL_FILES[@]}"; do
    if [[ -f "$BACKUP_DIR/$file" ]]; then
        log "✓ $file присутствует в бэкапе"
    else
        log "❌ ОШИБКА: $file отсутствует в бэкапе"
        exit 1
    fi
done

log "✅ Бэкап успешно создан и проверен"
log "Архив: $BACKUP_BASE_DIR/Peper_Binance_v4_$BACKUP_DATE.tar.gz"
log "Размер: $ARCHIVE_SIZE"
log "Контрольная сумма: $BACKUP_BASE_DIR/Peper_Binance_v4_$BACKUP_DATE.sha256"

echo ""
echo "🎉 БЭКАП ЗАВЕРШЕН УСПЕШНО!"
echo "📁 Архив: Peper_Binance_v4_$BACKUP_DATE.tar.gz"
echo "📊 Размер: $ARCHIVE_SIZE"
echo "📋 Лог: $LOG_FILE"
```

### 6.2 Скрипт быстрого бэкапа моделей

```bash
#!/bin/bash
# quick_models_backup.sh - Быстрый бэкап только моделей

MODELS_DIR="/Users/mac/Documents/Peper Binance v4 Clean/models"
BACKUP_DIR="/Users/mac/Documents/Backups/models_$(date +%Y%m%d_%H%M%S)"

echo "Создание быстрого бэкапа моделей..."
mkdir -p "$BACKUP_DIR"

# Копирование всех файлов моделей
cp -r "$MODELS_DIR"/* "$BACKUP_DIR/"

# Создание архива
cd "/Users/mac/Documents/Backups"
tar -czf "models_backup_$(date +%Y%m%d_%H%M%S).tar.gz" "$(basename "$BACKUP_DIR")/"

echo "✅ Быстрый бэкап моделей завершен: $BACKUP_DIR"
```

### 6.3 Скрипт автоматической очистки старых бэкапов

```bash
#!/bin/bash
# cleanup_old_backups.sh - Очистка старых бэкапов

BACKUP_DIR="/Users/mac/Documents/Backups"
DAYS_TO_KEEP=30  # Хранить бэкапы за последние 30 дней

echo "Очистка бэкапов старше $DAYS_TO_KEEP дней..."

# Удаление старых архивов
find "$BACKUP_DIR" -name "Peper_Binance_v4_*.tar.gz" -mtime +$DAYS_TO_KEEP -delete
find "$BACKUP_DIR" -name "Peper_Binance_v4_*.sha256" -mtime +$DAYS_TO_KEEP -delete

# Удаление старых директорий
find "$BACKUP_DIR" -name "Peper_Binance_v4_*" -type d -mtime +$DAYS_TO_KEEP -exec rm -rf {} +

echo "✅ Очистка завершена"
```

## 7. Проверка целостности резервных копий

### 7.1 Скрипт валидации бэкапа

```bash
#!/bin/bash
# validate_backup.sh - Проверка целостности бэкапа

BACKUP_ARCHIVE="$1"

if [[ -z "$BACKUP_ARCHIVE" ]]; then
    echo "Использование: $0 <путь_к_архиву_бэкапа>"
    exit 1
fi

echo "Валидация бэкапа: $BACKUP_ARCHIVE"

# Проверка существования файла
if [[ ! -f "$BACKUP_ARCHIVE" ]]; then
    echo "❌ ОШИБКА: Файл бэкапа не найден"
    exit 1
fi

# Проверка контрольной суммы
ARCHIVE_DIR=$(dirname "$BACKUP_ARCHIVE")
ARCHIVE_NAME=$(basename "$BACKUP_ARCHIVE" .tar.gz)
SHA_FILE="$ARCHIVE_DIR/${ARCHIVE_NAME}.sha256"

if [[ -f "$SHA_FILE" ]]; then
    echo "Проверка контрольной суммы..."
    cd "$ARCHIVE_DIR"
    if shasum -a 256 -c "${ARCHIVE_NAME}.sha256" >/dev/null 2>&1; then
        echo "✅ Контрольная сумма корректна"
    else
        echo "❌ ОШИБКА: Контрольная сумма не совпадает"
        exit 1
    fi
else
    echo "⚠️ Предупреждение: Файл контрольной суммы не найден"
fi

# Проверка содержимого архива
echo "Проверка содержимого архива..."
TEMP_DIR=$(mktemp -d)
cd "$TEMP_DIR"
tar -tzf "$BACKUP_ARCHIVE" >/dev/null 2>&1

if [[ $? -eq 0 ]]; then
    echo "✅ Архив корректен"
else
    echo "❌ ОШИБКА: Архив поврежден"
    rm -rf "$TEMP_DIR"
    exit 1
fi

# Извлечение и проверка критических файлов
tar -xzf "$BACKUP_ARCHIVE"
EXTRACTED_DIR=$(tar -tzf "$BACKUP_ARCHIVE" | head -1 | cut -f1 -d'/')

CRITICAL_FILES=(
    "main.py"
    "config.py"
    "ai_modules/trading_ai.py"
    "models/BTCUSDT_trading_model.joblib"
    "backup_manifest.txt"
)

for file in "${CRITICAL_FILES[@]}"; do
    if [[ -f "$EXTRACTED_DIR/$file" ]]; then
        echo "✅ $file присутствует"
    else
        echo "❌ ОШИБКА: $file отсутствует"
        rm -rf "$TEMP_DIR"
        exit 1
    fi
done

# Очистка
rm -rf "$TEMP_DIR"

echo "🎉 Валидация бэкапа прошла успешно!"
```

### 7.2 Ежедневная проверка бэкапов

```bash
#!/bin/bash
# daily_backup_check.sh - Ежедневная проверка всех бэкапов

BACKUP_DIR="/Users/mac/Documents/Backups"
LOG_FILE="$BACKUP_DIR/daily_check_$(date +%Y%m%d).log"

echo "Ежедневная проверка бэкапов - $(date)" > "$LOG_FILE"

# Проверка всех архивов за последние 7 дней
find "$BACKUP_DIR" -name "Peper_Binance_v4_*.tar.gz" -mtime -7 | while read archive; do
    echo "Проверка: $(basename "$archive")" >> "$LOG_FILE"
    
    if ./validate_backup.sh "$archive" >> "$LOG_FILE" 2>&1; then
        echo "✅ $(basename "$archive") - OK" >> "$LOG_FILE"
    else
        echo "❌ $(basename "$archive") - ОШИБКА" >> "$LOG_FILE"
    fi
done

echo "Проверка завершена. Лог: $LOG_FILE"
```

## 8. Инструкции по использованию

### 8.1 Создание полного бэкапа

```bash
# 1. Сделать скрипт исполняемым
chmod +x full_backup.sh

# 2. Запустить полный бэкап
./full_backup.sh

# 3. Проверить результат
ls -la /Users/mac/Documents/Backups/
```

### 8.2 Быстрое восстановление

```bash
# 1. Найти нужный бэкап
ls -la /Users/mac/Documents/Backups/Peper_Binance_v4_*.tar.gz

# 2. Восстановить систему
./restore_system.sh /Users/mac/Documents/Backups/Peper_Binance_v4_YYYYMMDD_HHMMSS.tar.gz

# 3. Проверить восстановление
./verify_restore.sh
```

### 8.3 Регулярное обслуживание

```bash
# Еженедельная очистка старых бэкапов
./cleanup_old_backups.sh

# Ежедневная проверка целостности
./daily_backup_check.sh
```

## 9. Контрольный список перед началом улучшений

### 9.1 Обязательные действия

- [ ] **Создан полный бэкап системы**
- [ ] **Проверена целостность бэкапа**
- [ ] **Создана контрольная сумма архива**
- [ ] **Протестирована процедура восстановления**
- [ ] **Документированы все изменения**

### 9.2 Рекомендуемые действия

- [ ] **Создан дополнительный бэкап на внешнем носителе**
- [ ] **Настроена автоматическая очистка старых бэкапов**
- [ ] **Создан календарь регулярных бэкапов**
- [ ] **Подготовлена команда для экстренного восстановления**

### 9.3 Финальная проверка

```bash
# Проверка наличия всех критических компонентов в бэкапе
echo "Финальная проверка бэкапа..."

LATEST_BACKUP=$(ls -t /Users/mac/Documents/Backups/Peper_Binance_v4_*.tar.gz | head -1)
echo "Последний бэкап: $LATEST_BACKUP"

# Валидация
./validate_backup.sh "$LATEST_BACKUP"

if [[ $? -eq 0 ]]; then
    echo "🎉 СИСТЕМА ГОТОВА К НАЧАЛУ УЛУЧШЕНИЙ!"
    echo "📁 Бэкап: $LATEST_BACKUP"
    echo "📋 Можно приступать к реализации плана улучшений"
else
    echo "❌ ОШИБКА: Бэкап не прошел валидацию"
    echo "🔄 Необходимо создать новый бэкап"
fi
```

---

**Важно**: Этот план бэкапа должен быть выполнен ПОЛНОСТЬЮ перед началом любых изменений в системе согласно плану улучшений из документа `План_улучшений_торговой_системы.md`.

**Дата создания**: 2024  
**Ответственный**: [Указать ответственного]  
**Статус**: Готов к выполнению  
**Приоритет**: КРИТИЧЕСКИЙ